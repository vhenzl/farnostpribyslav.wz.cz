<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Přesměrování…</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; padding: 2rem; line-height: 1.5; }
      code { background: #f2f2f2; padding: 0.1rem 0.3rem; border-radius: 4px; }
      a { color: #0b67ff; }
    </style>
  </head>
  <body>
    <h1>Přesměrování…</h1>
    <p>Pokud nebudete automaticky přesměrováni, klikněte na odkaz níže.</p>
    <p id="targetP"><a id="target" href="/">Domů</a></p>
    <script>
      (function() {
        try {
          const params = new URLSearchParams(window.location.search);
          const page = params.get('page');
          const rawIdr = params.get('idr') || params.get('id');
          const rok = params.get('rok') || params.get('year');

          const isNumeric = (s) => typeof s === 'string' && /^\d+$/.test(s);
          const idr = isNumeric(rawIdr) ? rawIdr : null;
          const isListUp = rawIdr === 'up';

          let target = '/';

          if (page === '0') {
            target = '/';
          } else if (page === '1') {
            // Historically "Akce"; route may not exist in the new site yet.
            target = '/';
          } else if (page === '2') {
            if (rok && idr) {
              // Detail zprávy
              target = `/zpravy/${encodeURIComponent(rok)}-${encodeURIComponent(idr)}`;
            } else if (rok && (isListUp || !rawIdr)) {
              // Výpis roku (idr absent or idr=up)
              target = `/zpravy#rok-${encodeURIComponent(rok)}`;
            } else {
              target = '/zpravy';
            }
          } else {
            // Fallbacks if page is missing/unknown
            if (rok && idr) {
              target = `/zpravy/${encodeURIComponent(rok)}-${encodeURIComponent(idr)}`;
            } else if (rok) {
              target = `/zpravy#rok-${encodeURIComponent(rok)}`;
            } else {
              target = '/';
            }
          }

          const a = document.getElementById('target');
          a.href = target;
          a.textContent = target;
          // Use replace() to avoid history pollution
          window.location.replace(target);
        } catch (e) {
          console.error('Redirect error', e);
        }
      })();
    </script>
  </body>
</html>
